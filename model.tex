The main simulation tool used in this work for studying the \gls{MSFR} is
Moltres. While we used Moltres for the steady-state and transient analysis, it
requires a dedicated neutron transport solver such as Serpent 2 to generate
neutron energy group constant data for the deterministic, multigroup
neutronics calculations in Moltres. This chapter provides brief descriptions
of the Serpent 2 code and Moltres.

\section{Serpent 2}

Serpent 2 \cite{leppanen_serpent_2014} is a continuous-energy Monte Carlo
reactor physics code under
active development at the VTT Technical Research Centre of Finland. It was
created in 2004 out of the need for better general-purpose neutron transport
codes for group constant generation in lattice geometries, and has since grown
to support more general capabilities, for an active user base of more than 500
people worldwide. Serpent is highly parallelizable due to its support for
both MPI and OpenMP parallel programming APIs, and highly validated and
verified against experimental data and other well-established codes.

In Serpent, each neutron is tracked through a combination of ray-tracing-based
surface tracking and rejection sampling-based delta-tracking. Users may define
the number of neutrons and the number of active and inactive cycles for each
simulation. Inactive cycles are required for fission source distribution
convergence, before interactions are tallied in the active cycles.
Interaction types and locations are
determined stochastically based on neutron interaction data from established
nuclear data libraries (e.g. ENDF, JEFF). These nuclear data libraries provide
continuous-energy cross section data at discrete temperatures. For other
temperatures, Serpent has a built-in Doppler-broadening preprocessor that
extrapolates the relevant cross section data from a lower temperature. 

In the context of this project, we used Serpent with the JEFF-3.1.2 nuclear
data library \cite{oecd/nea_jeff-3.1.2_2014} to generate group constants
for Moltres. The reactor geometry is based on the axisymmetric \gls{MSFR}
neutronics benchmark geometry published in several previous papers involving
the \gls{MSFR}, as shown in Fig. \ref{fig:msfrgeom}. The relevant group
constant data are collapsed into six neutron energy groups, and calculated for
temperature values of 800 K to 1300 K at 50 K intervals.

The group constants relevant for neutronics calculations in Moltres are the
macroscopic fission, absorption, and scattering neutron cross sections,
neutron diffusion coefficients, average fission energies, average neutron
yields, inverse neutron speeds, flux spectra, \gls{DNP} decay constants, and
effective delayed neutron fractions. These group constants are extracted from
the Serpent output files using a Python script available from the Github
repository that holds the Moltres source code. The script rewrites the group
constants into a Moltres-compatible format.

\section{Moltres}

Moltres is a \gls{MOOSE}-based application for coupled
neutronics/thermal-hydraulics simulations of \glspl{MSR}. \gls{MOOSE}
\cite{gaston_physics-based_2015} is a highly parallelizable,
finite element framework developed at \gls{INL} for simplifying the process of
creating fully-coupled, non-linear, multiphysics solvers. The framework
provides a user-friendly interface for this task through object-oriented
programming in C++. All aspects of a typical multiphysics problem, such as the
terms in the \glspl{PDE}, the initial and boundary conditions, the material
properties, etc., are represented in \gls{MOOSE} as C++ objects. New objects
can inherit properties from related old objects to simplify implementation and
reduce code duplication. Overall, this approach
is helpful for many researchers, a significant fraction of whom do not possess
high-level programming backgrounds, as they are unencumbered by the
technical details and complexities involved in programing mesh handling
and \gls{PDE} solving in finite element analysis.

\gls{MOOSE} itself relies heavily on libMesh \cite{kirk_libmesh:_2006} and
PETSc \cite{satish_petsc_2019} for its mesh handling and \gls{PDE} solver
functionalities. As a result, \gls{MOOSE} supports adaptive meshing schemes
and automatic variable scaling amongst other advanced features for improved
accuracy and performance times. Full
coupling is maintained by the execution of Newton-based solves on the
weak formulations of the multiple \glspl{PDE} to minimize the residual values.
Fully-coupled solves are essential for accurately resolving systems with
strongly interacting physics. The \gls{MSR} concept is one such example, where
the neutronics and thermal-hydraulics are tightly coupled through the Doppler
effect and the temperature dependence of liquid fuel salt density.

\gls{MOOSE}, and Moltres by extension, are capable of up to 3-D geometry
modelling. They support a wide range of input mesh file formats listed in a
\gls{MOOSE} webpage, including the commonly used Exodus II file format.
Specifically for the 2-D case, axial symmetry is easily and automatically
imposed by changing one line of code in the input file, without any changes in
the Cartesian representations of the \glspl{PDE} and boundary conditions in
their original C++ implementations. This feature provides significant
computational time savings for 3-D systems that exhibit high axial symmetry.
Another important feature for reducing computational time is the use of MPI
for parallel computing. All \gls{MOOSE}-based codes can be compiled and
run on high performance computing clusters.

\subsection{Neutronics}

Focusing our attention on Moltres, the neutron flux calculations are
performed using the standard formulations for the time-dependent multigroup
neutron diffusion equations and \gls{DNP} concentration equations as shown in
equations \ref{eq:neut} and \ref{eq:dnp}:
%
\begin{align}
    \frac{1}{v_g} \frac{\partial \phi_g}{\partial t} &= \nabla \cdot D_g
    \nabla \phi_g - \Sigma^r_g \phi_g +
    \sum^G_{g' \neq g} \Sigma^s_{g' \rightarrow g} \phi_{g'} + \chi^p_g
    \sum^G_{g'=1} (1-\beta) \nu \Sigma^f_{g'} \phi_{g'} + \chi^d_g \sum^I_i
    \lambda_i C_i, \label{eq:neut} \\
    \frac{\partial C_i}{\partial t} &= \beta_i \sum^G_{g'=1} \nu \Sigma^f_{g'}
    \phi_{g'} - \lambda_i C_i - \boldsymbol{u} \cdot \nabla C_i + \nabla \cdot
    D_t \nabla C_i, \label{eq:dnp} \\
    \intertext{where}
    v_g &= \text{average speed of neutrons in group $g$ [cm s$^{-1}$],} 
    \nonumber \\
    \phi_g &= \text{neutron flux in group $g$ [cm$^{-2}$ s$^{-1}$],} \nonumber
    \\
    t &= \text{time [s],} \nonumber \\
    D_g &= \text{diffusion coefficient of neutrons in group $g$ [cm$^2$
    s$^{-1}$],} \nonumber \\
    \Sigma^r_g &= \text{macroscopic cross section for removal of neutrons from
    group $g$ [cm$^{-1}$],} \nonumber \\
    \Sigma^s_{g' \rightarrow g} &= \text{macroscopic cross section of
    scattering from $g'$ to $g$ [cm$^{-1}$],} \nonumber \\
    \chi^p_g &= \text{prompt fission spectrum for neutrons in group $g$,}
    \nonumber \\
    G &= \text{total number of discrete neutron groups,} \nonumber \\
    \nu &= \text{average number of neutrons produced per fission,} \nonumber
    \\
    \Sigma^f_{g} &= \text{macroscopic fission cross section for neutron in
    group $g$ [cm$^{-1}$],} \nonumber \\
    \chi^d_g &= \text{delayed fission spectrum for neutrons in group $g$,}
    \nonumber \\
    I &= \text{total number of delayed neutron precursor groups,} \nonumber \\
    \beta &= \text{total delayed neutron fraction,} \nonumber \\
    \beta_i &= \text{delayed neutron fraction of precursor group $i$,}
    \nonumber \\
    \lambda_i &= \text{average decay constant of delayed neutron precursors in
    precursor group $i$,} \nonumber \\
    C_i &= \text{concentration of delayed neutron precursors in precursor
    group $i$,} \nonumber \\
    D_t &= \text{turbulent diffusion of the delayed neutron precursors [cm$^2$
    s$^{-1}$].} \nonumber
\end{align}
%

While the limitations of the multigroup neutron diffusion compared to other
deterministic and Monte Carlo methods, particularly for flux values near
boundaries, are well-documented, the diffusion model provides acceptable
accuracy at lower computational costs. Moreover, the
\gls{MSFR} contains no material interfaces in the middle of the core where
most of the fission interactions take place. The Results section provides a
comparison of the \gls{MSFR} multiplication factor values and reactivity
coefficients between Moltres and Serpent.

The \gls{DNP} concentration equation has additional advection and turbulent
diffusion terms to account for the movement of \glspl{DNP} in the primary
coolant loop. The turbulent diffusion value is governed by the following
equation:
%
\begin{align}
    D_t &= \frac{\mu_t}{\rho Sc_t}
\end{align}
%
where $\mu_t$ is the eddy viscosity [kg cm$^{-1}$ s$^{-1}$] , $\rho$ is the
density of the fuel salt [kg cm$^{-3}$], and $Sc_t$ is the turbulent Schmidt
number. We assumed $Sc_t = 0.85$ for a fair comparison with the Polimi/TUDelft
models which used the same value. Moltres also accounts for the decay of
\glspl{DNP} outside the active core region by simulating its flow in a
separate 1-D pipe geometry. This outer loop pipe simulation is loosely coupled
to the active core simulation through MOOSE's MultiApp functionality and
inlet/outlet boundary values. The loose coupling is justified as the evolution
of \gls{DNP} concentrations due to inflow is relatively slow. The length and
velocity defined in this geometry may differ according to reactor
specifications. For this work with the \gls{MSFR} model, we assumed a pipe
length of 2.255 m with salt flowing at 1.1275 m s$^{-1}$ for an out-of-core
residence time of 2 seconds to follow the design specifications.

Moltres users may vary the total number of neutron energy groups as
long as they provide Moltres with the appropriate group constant data. The
number of precursor groups is also variable, though usually predetermined by
the choice of nuclear data library in the group constant generation step.
Moltres automatically interpolates the group constant data for required
temperatures using one of the many predefined interpolation methods available
in \gls{MOOSE}. Once again, users have the freedom to select their
interpolation method of choice.

For this work, we have six neutron energy groups according to the energy
boundaries in table \ref{table:bound}, eight \gls{DNP} groups as defined by
the JEFF-3.1.2 library, and the spline interpolation method. The neutron flux
and \gls{DNP} concentration values were approximated by first-order Lagrange
and constant monomial shape functions respectively on the finite element mesh.
Figure * shows the mesh adopted for the \gls{MSFR} model.
We assumed vacuum boundary conditions for all six neutron group fluxes along
the external boundaries of the geometry, and homogeneous Neumann boundary
conditions along the axial symmetry boundary. For the \gls{DNP}
concentrations, we imposed homogeneous Neumann boundary conditions on the
walls, and inflow and outflow boundary conditions on the inlet and outlet
boundaries respectively. The inlet \gls{DNP} concentration values were
imported from the outlet values of the 1-D outer loop pipe at the same
timestep.

\begin{table}[htb!]
	\centering
	\caption{Neutron energy group upper bounds used in Serpent.}
	\begin{tabular}{c S}
		\toprule
		{Group number} & {Upper bound [MeV]}\\
		\midrule
		1 & 20\\
		2 & 2.2313\\
		3 & 0.4979\\
		4 & 0.0247875\\
		5 & 0.0055308\\
		6 & 0.0007485\\
		\bottomrule
	\end{tabular}
	\label{table:bound}
\end{table}

For the decay heat model, a previous study on the MSFR by Aufiero et al.
\cite{aufiero_extended_2013} has shown that using three decay heat precursor
groups with different half-lives in the form of exponential equations, can
accurately model decay heat in the MSFR for up to 300 seconds after shutdown
with a relative error of less than 2\%. Thus, we implemented a decay heat
model using the following equation:
%
\begin{align}
	\frac{\partial \omega_k}{\partial t} &= f_k \sum^G_{g=1} \epsilon_{g}
	\Sigma^f_{g} \phi_{g} - \lambda^k \omega_k - \boldsymbol{u} \cdot \nabla
	\omega_k + \nabla \cdot D_t \nabla \omega_k, \label{eq:decayheat} \\
	\intertext{where}
    \omega_k &= \text{total decay heat power density from decay heat
    precursors in group $k$ [W cm$^{-3}$]} \nonumber \\
	f_k &= \text{fraction of decay heat to total power at steady state}
	\nonumber \\
	\epsilon_g &= \text{average fission energy per fission [W]} \nonumber \\
	\lambda^k &= \text{average decay constant of decay heat precursors in
	group $k$ [s$^{-1}$].} \nonumber
\end{align}

Like the neutron and \gls{DNP} groups, Moltres can take an arbitrary number of
decay heat groups. In this work, as with the other parameters, we used the
same decay heat fractions and decay constants used in the Polimi/TUDelft
models for three decay heat groups.

\begin{table}[htb!]
	\centering
	\caption{Decay heat group parameters \cite{fiorina_modelling_2014}.
	$\lambda_i$ and $f_i$ are the decay constants and decay heat fractions
	associated to group $i$.}
	\begin{tabular}{S S S}
		\toprule
		{Decay heat group} & {$\lambda_i$ [s$^{-1}$]} & {$f_i$} \\
		\midrule
		1 & 0.1974 & 0.0117 \\
		2 & 0.0168 & 0.0129 \\
		3 & 0.000358 & 0.0186 \\
		\bottomrule
	\end{tabular}
	\label{table:decayheat}
\end{table}

\subsection{Thermal-Hydraulics}

Fluid dynamics in Moltres can be modeled using the \gls{INS} equations with
the Boussinesq hypothesis for eddy viscosity. Most of the Navier-Stokes
capabilities in Moltres is derived from the MOOSE Navier-Stokes module
\cite{peterson_overview_2017}. The standard \gls{INS} equations are:
%
\begin{align}
    \text{Momentum eq.:} && \rho \frac{\partial \boldsymbol{u}}{\partial t} &=
    -\rho (\boldsymbol{u}
    \cdot \nabla) \boldsymbol{u} + \nabla \cdot (-p \boldsymbol{I} + \mu [
    \nabla \boldsymbol{u} + (\nabla \boldsymbol{u})^T] + \boldsymbol{f} &&
    \label{eq:momemtum} \\
    \text{Divergence-free:} && \nabla \cdot \boldsymbol{u} &= 0 &&
    \label{eq:divergence}
    \intertext{where}
    && p &= \text{ pressure} && \nonumber \\
    && \mu &= \text{ dynamic viscosity} && \nonumber \\
    && \boldsymbol{f} &= \text{ body force per unit volume} && \nonumber
\end{align}

In addition to the intrinsic molecular viscosity, we introduced an eddy
viscosity term to approximate turbulent flow effects. The current
implementation of Moltres does not have a turbulence model such as the
\gls{RANS} models used in the Polimi/TUDelft models. Thus, we made a
zeroth-order approximation of the eddy viscosity based on the results reported
in the Polimi/TUDelft models. The eddy viscosity is assumed to be 40 Pa s.
Despite the simplicity of this assumption, we were able to reproduce much of
the flow profile observed in the Polimi/TUDelft models at steady state.

The flow rate is dictated by an inflow boundary condition at the core inlet
for a volumetric flow rate of 4.5 m$^3$ s$^{-1}$. We imposed no-slip boundary
conditions on the walls of the core, and homogeneous Neumann boundary
conditions on the core outlet. The energy balance equation for temperature is
given in Eq. \ref{eq:temp}. The diffusion term includes turbulent heat
diffusivity based on the eddy viscosity $\mu_t$ and the turbulent Prandtl
number $Pr_t$, which we assume to be equal to 0.85. 
%
\begin{align}
    \rho c_{p} \frac{\partial T}{\partial t} &= - \rho c_p \boldsymbol{u}
    \cdot \nabla T + \nabla \cdot [(k + k_t) \nabla T] + Q_s - Q_{hx}
    \label{eq:temp} \\
    k_t &= \frac{\mu_t}{\rho Pr_t} \\
    Q_s &= \Big( 1 - \sum^K_{k=1} f_k \Big) \sum^G_{g=1} \epsilon_g \Sigma_g^f
    \phi_g + \sum^K_{k=1} \omega_k, \label{eq:source}
    \intertext{where}
    \rho &= \text{density of molten salt} \nonumber \\
    c_{p} &= \text{specific heat capacity of molten salt} \nonumber \\
    T &= \text{temperature of molten salt} \nonumber \\
    \boldsymbol{u} &= \text{velocity of molten salt} \nonumber \\
    k &= \text{thermal conductivity of molten salt} \nonumber \\
    Q_{hx} &= \text{heat sink} \nonumber \\
\end{align}
%
where $K$ is the total number of decay heat groups. The first term in the heat
source expression represents prompt fission heat, and the second term
represents decay heat from the $K$ decay heat groups.

We modeled the heat exchanger using a point source/sink at the center of the
1-D outer loop pipe region. The rate of heat extraction is equivalent to the
nominal 3 GW$_{\text{th}}$ power output with appropriate scaling to account
for the 1-D geometry. *** include more detail when finalized ***

We expect good qualitative agreement with the Polimi/TUDelft models,
including the large recirculation region near the blanket tank walls and the
resulting high temperatures in that region. There would be some minor
discrepancies where the viscosity values are under- or over-predicted, leading
to slightly inaccurate temperature and precursor concentration values from
turbulent diffusion.

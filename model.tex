This work demonstrates the \gls{MSFR} simulation capabilities of Moltres, a
multiphysics simulation tool for \glspl{MSR} \cite{lindsay_introduction_2018}.
To run simulations on Moltres, it requires input
group constant data from a neutron transport solver for the
multigroup neutron diffusion calculations, and a mesh file representing the
geometry of the reactor. This work uses Serpent 2 \cite{leppanen_serpent_2014}
for the former and Trelis \cite{noauthor_trelis_2018} for the latter.
This chapter provides brief introductions to
Serpent 2, \gls{MOOSE}, and Moltres, and the modeling approach for the
multiphysics simulations in Moltres.

\section{Serpent 2}

Serpent 2 \cite{leppanen_serpent_2014} is a continuous-energy Monte Carlo
neutron transport application under
active development led by the VTT Technical Research Centre of Finland. It was
created in 2004 for group constant generation in lattice geometries, and has
since grown to support more general capabilities. Serpent 2 is highly
parallelizable, supporting
both MPI and OpenMP parallel programming APIs. It has also been validated and
verified against experimental data and other well-established codes.

In Serpent 2, each neutron is tracked through a combination of
ray-tracing-based surface tracking and rejection sampling-based delta
tracking. Users may define the number of neutron histories and the number of
active and inactive cycles for each
simulation. Inactive cycles are required for fission source distribution
convergence, before interactions are tallied in the active cycles.
Interaction types and locations are
determined stochastically based on neutron interaction data from established
nuclear data libraries (e.g. ENDF \cite{chadwick_endf/b-vii.1_2011}, JEFF
\cite{oecd/nea_jeff-3.1.2_2014}). These nuclear data libraries provide
continuous-energy cross section data at discrete temperatures. Beyond the
discrete library temperatures, Serpent 2 has a built-in Doppler-broadening
preprocessor that extrapolates the relevant cross section data from a lower
temperature \cite{leppanen_serpent_2014}. 

In the context of this work, Serpent 2 uses the JEFF-3.1.2 nuclear
data library \cite{oecd/nea_jeff-3.1.2_2014} to generate group constants
needed by Moltres. The relevant group constant data are collapsed into six
neutron energy groups, and calculated at discrete temperature values from 800
K to 1300 K at 100 K intervals. Table \ref{table:bound} shows the upper bounds
of each neutron energy group. The group constants relevant for neutronics
calculations in Moltres are the
macroscopic fission $\Sigma^f_{g}$, removal $\Sigma^r_{g}$, and scattering
$\Sigma^s_{g' \rightarrow g}$ neutron cross sections,
neutron diffusion coefficients $D_g$, average fission energies $\epsilon_g$,
average neutron yields $\nu$, inverse neutron speeds $1/v$, flux spectra
$\chi$, \gls{DNP} decay constants $\lambda_i$, and effective delayed neutron
fractions $\beta_{eff}$. These group constants are extracted from
the Serpent 2 output files using a Python script available from the Github
repository that holds the Moltres source code \cite{lindsay_moltres_2017}. The
script rewrites the group constants into a Moltres-compatible format.

Serpent 2 provides standard geometric surfaces (e.g. planes, cylinders, cones)
for defining reactor geometries. In this work, the reactor geometry is the
same axisymmetric \gls{MSFR} geometry from the paper by Fiorina et al.
\cite{fiorina_modelling_2014}, as shown in Fig. \ref{fig:msfrgeom}.

\begin{table}[htb!]
	\centering
	\caption{Neutron energy group upper bounds used in Serpent 2.}
	\begin{tabular}{c S}
		\toprule
		{Group number} & {Upper bound [MeV]}\\
		\midrule
		1 & 20\\
		2 & 2.2313\\
		3 & 0.4979\\
		4 & 0.0247875\\
		5 & 0.0055308\\
		6 & 0.0007485\\
		\bottomrule
	\end{tabular}
	\label{table:bound}
\end{table}

\section{MOOSE}

\gls{MOOSE} \cite{gaston_physics-based_2015} is a highly parallelizable,
finite element framework developed at \gls{INL} for simplifying the process of
creating fully-coupled, non-linear, multiphysics solvers. The framework
provides a user-friendly interface for this task through object-oriented
programming in C++. All aspects of a typical multiphysics problem, such as the
terms in the \glspl{PDE}, the initial and boundary conditions, the material
properties, etc., are represented in \gls{MOOSE} as C++ objects. New objects
can inherit properties from related old objects to simplify implementation and
reduce code duplication. These objects are commonly referred to as kernels in
\gls{MOOSE}. Overall, this approach
is helpful for many researchers, a significant fraction of whom do not possess
high-level programming backgrounds, as they are unencumbered by the
technical details and complexities involved in programing mesh handling
and \gls{PDE} solving in finite element analysis.

\gls{MOOSE} itself relies on libMesh \cite{kirk_libmesh:_2006} and
PETSc \cite{satish_petsc_2019} for its mesh handling and \gls{PDE} solver
functionalities. As a result, \gls{MOOSE} supports adaptive meshing schemes
and automatic variable scaling amongst other advanced features for improved
accuracy and performance times. Full
coupling is maintained by the execution of Newton-based solves on the
weak formulations of the multiple \glspl{PDE} to minimize the residual values.
Fully-coupled solves are essential for accurately resolving systems with
strongly interacting physics. The \gls{MSR} concept is one such example, where
the neutronics and thermal-hydraulics are tightly coupled through the Doppler
effect and the temperature dependence of liquid fuel salt density.

\gls{MOOSE}, and Moltres by extension, are capable of up to 3-D geometry
modelling. They support a wide range of input mesh file formats listed in a
\gls{MOOSE} webpage, including the commonly used Exodus II file format.
Specifically for the 2-D case, axial symmetry is easily and automatically
imposed by changing one line of code in the input file, without any changes in
the Cartesian representations of the \glspl{PDE} and boundary conditions in
their original C++ implementations. This feature provides significant
computational time savings for 3-D systems that exhibit high axial symmetry.
Another important feature for reducing computational time is the use of MPI
for parallel computing. All \gls{MOOSE}-based codes can be compiled and
run on high performance computing clusters.

\gls{MOOSE} includes a set of built-in physics modules for commonly studied
phenomena such as the heat conduction, flow dynamics and solid mechanics. This
work uses \gls{MOOSE}'s Navier-Stokes module for simulating
incompressible salt flow in the \gls{MSFR}. Peterson et al. verified the
incompressible flow capabilities in the
Navier-Stokes module and presented results for common \gls{CFD} problems such
as the lid-driven cavity, axisymmetric channel, and flow-over-a-sphere
problems \cite{peterson_overview_2017}. 

\section{Moltres}

Moltres is an application built in the \gls{MOOSE} parallel finite element
framework \cite{lindsay_introduction_2018}. Similar to the physics modules in
\gls{MOOSE}, Moltres contains the necessary kernels representing various
physics and boundary conditions for solving for the neutron flux, delayed
neutron precursor concentration, and temperature. Together with the
Navier-Stokes module, it solves
the deterministic multigroup neutron diffusion and thermal-hydraulics
\glspl{PDE} simultaneously on the same mesh. Moltres supports up to 3-D meshes
and scales well over a large number of processors. The underlying \gls{MOOSE}
framework provides a range of implicit and explicit methods for the coupling
between the neutronics and thermal-hydraulics governing equations.

In the introductory journal article for Moltres, Lindsay et al.
\cite{lindsay_introduction_2018} demonstrated Moltres' capabilities with
2D-axisymmetric and 3D models of the \gls{MSRE}. The results showed good
qualitative agreement with legacy \gls{MSRE} data with some minor
quantitative discrepancies due to a number of differences in the legacy model. 
Since then, Moltres has undergone further development in the past three years.
The authors of the first paper have since developed various new capabilities
in Moltres, most significantly providing support for looping delayed neutron
precursors back into the core, and a pointwise heat removal kernel to simulate
a heat exchanger. The present author demonstrated these capabilities in a
2-D axisymmetric model of the \gls{MSFR} with uniform salt flow
\cite{park_safety_2019}. 

Building on the prior progress, this thesis presents two more recent
developments in Moltres, namely the new kernels required to couple
incompressible flow with the delayed neutron precursor looping capability, and
introducing a decay heat model to simulate decay heat from fission products.
The incompressible flow profile from \gls{MOOSE}'s Navier-Stokes module
provides a more accurate representation of the flow profile, precursor
movement, and heat transfer as opposed to assuming uniform velocity fields
featured in the previous papers \cite{lindsay_introduction_2018,
park_safety_2019}.

\section{Modeling Approach}

This section discusses the neutronics and thermal-hydraulics
\glspl{PDE} that Moltres solves and other relevant details specific to the
\gls{MSFR} model in this work.

As mentioned in the previous chapter, the fuel salt loop is divided into two
regions, the central core region where most of the fissions take place, and
the outer loop region where the heat exchanger is located. The central core
region specifically refers to the central region indicated by
the red box in Figure \ref{fig:core}. The outer loop is simplified
into a 1-D pipe as it is a subcritical region and its main purposes are: to
introduce an out-of-core residence time for the \glspl{DNP}, and to contain
the heat removal kernel to simulate the heat exchanger.
Accordingly, this section provides separate descriptions for the governing
equations in the central core region and the outer loop region. There is also
a third region comprised of the blanket salt, the NiCrW Hastelloy reflectors, 
and other material. This region is important for capturing a more accurate
estimate of neutron leakage than would
imposing fixed albedo neutron flux boundary conditions.

\begin{figure}[htb!]
    \centering
    \includegraphics[width=.5\textwidth]{central-core}
    \caption{2-D axisymmetric model of the MSFR. The red box indicates the
    central core region in the modeling approach in Moltres.}
    \label{fig:core}
\end{figure}

\subsection{Central Core Region}

The central core region is of greatest interest to us during steady state and
transient scenarios; the center of the reactor is naturally where most of the
fissions and heat generation occur.

\subsubsection{Neutronics Model}

The neutron flux calculations in the central core region are
performed using the standard formulations for the time-dependent multigroup
neutron diffusion equations and \gls{DNP} concentration equations as shown in
equations \ref{eq:neut} and \ref{eq:dnp}:
%
\begin{align}
    \frac{1}{v_g} \frac{\partial \phi_g}{\partial t} &= \nabla \cdot D_g
    \nabla \phi_g - \Sigma^r_g \phi_g +
    \sum^G_{g' \neq g} \Sigma^s_{g' \rightarrow g} \phi_{g'} + \chi^p_g
    \sum^G_{g'=1} (1-\beta) \nu \Sigma^f_{g'} \phi_{g'} + \chi^d_g \sum^I_i
    \lambda_i C_i, \label{eq:neut} \\
    \frac{\partial C_i}{\partial t} &= \beta_i \sum^G_{g'=1} \nu \Sigma^f_{g'}
    \phi_{g'} - \lambda_i C_i - \vec{u} \cdot \nabla C_i + \nabla \cdot
    K \nabla C_i, \label{eq:dnp} \\
    \intertext{where}
    v_g &= \text{average speed of neutrons in group $g$ [cm$\cdot$s$^{-1}$],} 
    \nonumber \\
    \phi_g &= \text{neutron flux in group $g$ [cm$^{-2}\cdot$s$^{-1}$],}
    \nonumber \\
    t &= \text{time [s],} \nonumber \\
    D_g &= \text{diffusion coefficient of neutrons in group $g$
    [cm$^2\cdot$s$^{-1}$],} \nonumber \\
    \Sigma^r_g &= \text{macroscopic cross section for removal of neutrons from
    group $g$ [cm$^{-1}$],} \nonumber \\
    \Sigma^s_{g' \rightarrow g} &= \text{macroscopic cross section of
    scattering from $g'$ to $g$ [cm$^{-1}$],} \nonumber \\
    \chi^p_g &= \text{prompt fission spectrum for neutrons in group $g$,}
    \nonumber \\
    G &= \text{total number of discrete neutron groups,} \nonumber \\
    \nu &= \text{average number of neutrons produced per fission,} \nonumber
    \\
    \Sigma^f_{g} &= \text{macroscopic fission cross section for neutron in
    group $g$ [cm$^{-1}$],} \nonumber \\
    \chi^d_g &= \text{delayed fission spectrum for neutrons in group $g$,}
    \nonumber \\
    I &= \text{total number of delayed neutron precursor groups,} \nonumber \\
    \beta &= \text{total delayed neutron fraction,} \nonumber \\
    \beta_i &= \text{delayed neutron fraction of precursor group $i$,}
    \nonumber \\
    \lambda_i &= \text{average decay constant of delayed neutron precursors in
    precursor group $i$ [s$^{-1}$],} \nonumber \\
    C_i &= \text{concentration of delayed neutron precursors in precursor
    group $i$ [cm$^{-3}$],} \nonumber \\
    K &= \text{turbulent diffusion of the delayed neutron precursors
    [cm$^2\cdot$s$^{-1}$].} \nonumber
\end{align}
%

While the limitations of the multigroup neutron diffusion compared to other
deterministic and Monte Carlo methods, particularly for flux values near
boundaries, are well-documented, the diffusion model provides acceptable
accuracy at lower computational costs. Moreover, the central core region
contains no material interfaces except at its boundaries. Chapter
\ref{chap:nts} provides a comparison of the \gls{MSFR} multiplication factor
values and reactivity coefficients between Moltres and Serpent.

The \gls{DNP} concentration equation has additional advection and turbulent
diffusion terms to account for the movement of \glspl{DNP} in the primary
coolant loop. The turbulent diffusion $K$ is governed by the following
equation:
%
\begin{align}
    K &= \frac{\mu_t}{\rho Sc_t}
    \intertext{where}
    \mu_t &= \text{ eddy viscosity [Pa s],} \nonumber \\ 
    \rho &= \text{ density of the fuel salt [kg m$^{-3}$],} \nonumber \\
    Sc_t &= \text{ turbulent Schmidt number.} \nonumber
\end{align}
%
This work assumes $Sc_t = 0.85$ for a fair comparison with the Polimi and
TUDelft models \cite{fiorina_modelling_2014} which used the same value. It has
its roots in the Reynolds Analogy which states that turbulent momentum and
heat transfer largely depend on the same eddies in turbulent flow
\cite{bartosiewicz_612_2019}. Therefore,
$Sc_t$ should be close to unity. $Sc_t = 0.85$ is also the default value for
most commercial \gls{CFD} software \cite{bartosiewicz_612_2019}.

\begin{figure}[htb!]
    \centering
    \includegraphics[width=\textwidth]{mesh2}
    \caption{Mesh adopted in Moltres and a close-up view of the mesh around
    the boron carbide absorber.}
    \label{fig:mesh}
\end{figure}

Moltres users may vary the total number of neutron energy groups as
long as they provide Moltres with the appropriate group constant data. The
number of precursor groups is also variable, though usually predetermined by
the choice of nuclear data library in the group constant generation step.
Moltres automatically interpolates the group constant data for required
temperatures using one of the many predefined interpolation methods available
in \gls{MOOSE}. Once again, Moltres allows users to select their
interpolation method of choice.

The \gls{MSFR} model in this work six neutron energy groups according to the
energy boundaries in table \ref{table:bound}, and eight \gls{DNP} groups as
defined by the JEFF-3.1.2 library. The neutron flux
and \gls{DNP} concentration values were approximated by first-order Lagrange
and constant monomial shape functions respectively on the finite element mesh.
Figure \ref{fig:mesh} shows the mesh adopted for the \gls{MSFR} model.
This work assumes vacuum boundary conditions for all six neutron group fluxes
along
the external boundaries of the geometry, and homogeneous Neumann boundary
conditions along the axial symmetry boundary. For the \gls{DNP}
concentrations, we imposed homogeneous Neumann boundary conditions on the
walls, and inflow and outflow boundary conditions on the inlet and outlet
boundaries respectively. The inlet \gls{DNP} concentration values were
imported from the outlet values of the 1-D outer loop pipe at the same
timestep.

For the decay heat model, a previous study on the MSFR by Aufiero et al.
\cite{aufiero_extended_2013} showed that using three decay heat precursor
groups with appropriate half-lives in the form of exponential equations, can
accurately model decay heat in the MSFR for up to 300 seconds after shutdown
with a relative error of less than 2\%. Thus, this thesis implements the new
decay heat modeling capability with the following equation:
%
\begin{align}
	\frac{\partial \omega_j}{\partial t} &= f_j \sum^G_{g=1} \epsilon_{g}
	\Sigma^f_{g} \phi_{g} - \lambda_j \omega_j - \vec{u} \cdot \nabla
	\omega_j + \nabla \cdot K \nabla \omega_j, \label{eq:decayheat} \\
	\intertext{where}
    \omega_j &= \text{total decay heat power density from decay heat
    precursors in group $j$ [W$\cdot$cm$^{-3}$],} \nonumber \\
	f_j &= \text{fraction of decay heat from group $j$ to total power under
	full-power conditions,}
	\nonumber \\
	\epsilon_g &= \text{average fission energy per fission [W],} \nonumber \\
	\lambda_j &= \text{average decay constant of decay heat precursors in
	group $j$ [s$^{-1}$].} \nonumber
\end{align}

Like the neutron and \gls{DNP} groups, Moltres can accommodate an arbitrary
number of decay heat groups. This work uses the same decay heat fractions and decay constants, shown in Table
\ref{eq:decayheat}, used in the Polimi and TUDelft models for three decay heat
groups.

\begin{table}[htb!]
	\centering
	\caption{Decay heat group parameters \cite{fiorina_modelling_2014}.}
	\begin{tabular}{S S S}
		\toprule
		{Decay heat group $j$} & {$\lambda_j$ [s$^{-1}$]} & {$f_j$} \\
		\midrule
		1 & 0.1974 & 0.0117 \\
		2 & 0.0168 & 0.0129 \\
		3 & 0.000358 & 0.0186 \\
		\bottomrule
	\end{tabular}
	\label{table:decayheat}
\end{table}

\subsubsection{Thermal-Hydraulics Model}

This work models fluid dynamics using the \gls{INS} capabilities from the
MOOSE Navier-Stokes module \cite{peterson_overview_2017}. The standard
\gls{INS} equations are:
%
\begin{align}
    \text{Momentum eq.:} && \rho \frac{\partial \vec{u}}{\partial t} &=
    -\rho (\vec{u}
    \cdot \nabla) \vec{u} + \nabla \cdot (-p \vec{I} + \mu [
    \nabla \vec{u} + (\nabla \vec{u})^T] + \vec{f} &&
    \label{eq:momemtum} \\
    \text{Divergence-free:} && \nabla \cdot \vec{u} &= 0 &&
    \label{eq:divergence}
    \intertext{where}
    && p &= \text{ pressure [Pa],} && \nonumber \\
    && \mu &= \text{ dynamic viscosity [Pa s],} && \nonumber \\
    && \vec{f} &= \text{ body force per unit volume [N$\cdot$m$^{-3}$].} &&
    \nonumber
\end{align}

In addition to the intrinsic molecular viscosity, this thesis introduces an
eddy viscosity term to approximate turbulent flow effects. The current
implementation of the Navier-Stokes module does not have a turbulence model
such as the \gls{RANS} models used in the Polimi and TUDelft models
\cite{fiorina_modelling_2014}. Thus, this work uses
a zeroth-order approximation of the eddy viscosity based on the results
reported in the Polimi/TUDelft models. The eddy viscosity is assumed to be 40
Pa s. Despite the simplicity of this assumption, the resulting flow profile is
similar to flow profile in the Polimi and TUDelft models at steady state.

The energy balance equation for temperature used in this Moltres model is:
%
\begin{align}
    \rho c_{p} \frac{\partial T}{\partial t} &= - \rho c_p \vec{u}
    \cdot \nabla T + \nabla \cdot [(k + k_t) \nabla T] + Q_s
    \label{eq:temp} \\
    k_t &= \frac{\mu_t}{\rho Pr_t} \\
    Q_s &= \Big( 1 - \sum^J_{j=1} f_j \Big) \sum^G_{g=1} \epsilon_g \Sigma_g^f
    \phi_g + \sum^J_{j=1} \omega_j, \label{eq:source}
    \intertext{where}
    c_p &= \text{specific heat capacity of molten salt
    [J$\cdot$kg$^{-1}\cdot$K$^{-1}$],} \nonumber \\
    T &= \text{temperature of molten salt [K]} \nonumber \\
    \vec{u} &= \text{velocity of molten salt [m$\cdot$s$^{-1}$],}
    \nonumber \\
    k &= \text{thermal conductivity of molten salt
    [W$\cdot$m$^{-1}\cdot$K$^{-1}$],} \nonumber \\
    J &= \text{total number of decay heat groups.} \nonumber
\end{align}
%
The diffusion term includes turbulent heat
diffusivity based on the eddy viscosity $\mu_t$ and the turbulent Prandtl
number $Pr_t$. $Pr_t$ is also 0.85 due to the same reasoning provided for
$Sc_t$. The first term in the heat source $Q_s$ equation represents prompt
fission heat, and the second term represents decay heat from the $J$ decay
heat groups.

With this model, the results were expected to show good qualitative agreement
with the Polimi and TUDelft models, including the large recirculation region
near the blanket tank walls and the resulting high temperatures in that
region. The results in Chapter \ref{chap:ss} would be some minor
discrepancies where the viscosity values are under- or over-predicted, leading
to minor inaccuracies in temperature and precursor concentration distributions
from turbulent diffusion.

\subsubsection{Boundary Conditions}

Table \ref{table:corebc} summarizes the boundary conditions for all variables
on all of the relevant boundaries. Figure \ref{fig:msfrbc} shows the locations
of the various boundaries listed in the table.

\begin{table}[htbp!]
    \small
	\caption{Boundary conditions in the main reactor geometry (Figure
	\ref{fig:msfrbc}.}
	\centering
	\begin{tabular}{ l l c}
		\toprule
		Variable & Boundary & Boundary Condition \\
		\midrule
		\multirow{4}{*}{Neutron flux $\phi_g$} & Top & $\frac{d \phi_g}{dx}
		\big|_{\text{inflow}} = 0$ \\
        & Outer & $\frac{d \phi_g}{dx} \big|_{\text{inflow}} = 0$ \\
        & Bottom & $\frac{d \phi_g}{dx} \big|_{\text{inflow}} = 0$ \\
        & Axial & $\frac{d \phi_g}{dx} = 0$ \\
        \midrule
        \multirow{6}{*}{Delayed neutron precursor concentration $C_i$} &
        Top (Core) & $\frac{d C_i}{dx} = 0$ \\
        & Bottom (Core) & $\frac{d C_i}{dx} = 0$ \\
        & Outer (Core) & $\frac{d C_i}{dx} = 0$ \\
        & Axial (Core) & $\frac{d C_i}{dx} = 0$ \\
        & Inlet (Core) & $C_i = c$ \\
        & Outlet (Core) & $u_x \cdot C_i = 0$ \\
        \midrule
        \multirow{6}{*}{Decay heat power density $\omega_j$} &
        Top (Core) & $\frac{d \omega_j}{dx} = 0$ \\
        & Bottom (Core) & $\frac{d \omega_j}{dx} = 0$ \\
        & Outer (Core) & $\frac{d \omega_j}{dx} = 0$ \\
        & Axial (Core) & $\frac{d \omega_j}{dx} = 0$ \\
        & Inlet (Core) & $\omega_j = c$ \\
        & Outlet (Core) & $u_x \cdot \omega_j = 0$ \\
        \midrule
        \multirow{6}{*}{Radial velocity $u_x$} & Top (Core) & $u_x = 0$ \\
        & Bottom (Core) & $u_x = 0$ \\
        & Outer (Core) & $u_x = 0$ \\
        & Axial (Core) & $u_x = 0$ \\
        & Inlet (Core) & $u_x = c$ \\
        & Outlet (Core) & $\frac{d u_x}{dx} = 0$ \\
        \midrule
        \multirow{6}{*}{Axial velocity $u_y$} & Top (Core) & $u_y = 0$ \\
        & Bottom (Core) & $u_y = 0$ \\
        & Outer (Core) & $u_y = 0$ \\
        & Axial (Core) & $\frac{d u_y}{dx} = 0$ \\
        & Inlet (Core) & $u_y = 0$ \\
        & Outlet (Core) & $\frac{d u_y}{dx} = 0$ \\
        \midrule
        \multirow{6}{*}{Temperature $T$} & Top (Core) &
        $\frac{d T}{dx} = 0$ \\
        & Bottom (Core) & $\frac{d T}{dx} = 0$ \\
        & Outer (Core) & $\frac{d T}{dx} = 0$ \\
        & Axial (Core) & $\frac{d T}{dx} = 0$ \\
        & Inlet (Core) & $T = c$ \\
        & Outlet (Core) & $\frac{d T}{dx} = 0$ \\
		\bottomrule
	\end{tabular}
	\label{table:corebc}
\end{table}

\clearpage

\begin{figure}[htb!]
    \centering
    \includegraphics[width=\textwidth]{msfrbc}
    \caption{The boundaries in the \gls{MSFR} geometry that are relevant for
    the boundary conditions mentioned in Table \ref{table:corebc}.}
    \label{fig:msfrbc}
\end{figure}

\subsection{Outer Loop Region}

Moltres also accounts for the decay of
\glspl{DNP} outside the central core region by simulating its flow in a
separate 1-D pipe geometry. This outer loop pipe simulation is implicitly
coupled to the active core simulation through Picard iterations in MOOSE's
MultiApp functionality and inlet/outlet boundary values. For this work with
the \gls{MSFR} model, we assumed a pipe
length of 2.255 m with salt flowing at 1.1275 m s$^{-1}$ for an average
out-of-core residence time of 2 seconds to follow the design specifications.

\subsubsection{Neutronics Model}

Since this outer loop region is largely subcritical, the only significant
neutronics-related phenomena are the drift and decay of \glspl{DNP}.
The governing equation for the \glspl{DNP} is:
%
\begin{align}
    \frac{\partial C_i}{\partial t} &= - \lambda_i C_i - u
    \frac{\partial C_i}{\partial x}.
    \label{eq:dnploop}
\end{align}
%
Equation \ref{eq:dnploop} is derived from equation \ref{eq:dnp} by removing
the fission \gls{DNP} source term, and the conversion of the advection and
diffusion terms to their 1-D forms. The decay constants and diffusion
coefficient are the same values used in the central core region.

\subsubsection{Thermal-Hydraulics Model}

A constant velocity of 1.1275 m s$^{-1}$ is applied in the outer loop region.
The governing equation for
temperature, derived from equation \ref{eq:temp}, is:
%
\begin{align}
    \rho c_{p} \frac{\partial T}{\partial t} &= - \rho c_p u
    \frac{\partial T}{\partial x} - Q_{hx} \label{eq:temploop} \\
    Q_{hx} &= \alpha (T - T_i) \delta (x_0) \label{eq:hx} \\
    \intertext{where}
    Q_{hx} &= \text{heat removal rate through the heat exchanger [W],} 
    \nonumber \\
    \alpha &= \text{heat transfer coefficient [W$\cdot$K$^{-1}$],} \nonumber
    \\
    T_i &= \text{temperature of the intermediate salt [K],} \nonumber \\
    x_0 &= \text{position of the point heat exchanger [m].} \nonumber
\end{align}

The fission heat source term is replaced with a heat exchanger sink term
$Q_{hx}$
which depends on the temperature difference between the fuel salt $T$ and the
intermediate loop salt $T_i$. For simplicity, this work assumes a constant
temperature of 823 K in the intermediate loop. The heat transfer coefficient
was determined by assuming that the fuel outlet temperature is 1023 K and
calculating the heat removal rate to induce a 100 K drop at the given
volumetric flow rate and heat capacity of the fuel salt. The resulting value
for $\alpha$ is 370.668 W$\cdot$K$^{-1}$. This work opted to
ignore the diffusion term due to the discontinuity of the temperature
distribution across the point heat exchanger. 

\subsubsection{Boundary Conditions}

Table \ref{table:loopbc} summarizes the boundary conditions for all variables
on the inlet and outlet of the 1-D outer loop region.

\begin{table}[htbp!]
    \small
	\caption{Boundary conditions in the 1-D outer loop geometry. $u$
	represents the 1-D velocity in this region.}
	\centering
	\begin{tabular}{ l l c}
		\toprule
		Variable & Boundary & Boundary Condition \\
        \midrule
        \multirow{2}{*}{Delayed neutron precursor concentration $C_i$} &
        Inlet (Core) & $C_i = c$ \\
        & Outlet (Core) & $u \cdot C_i = 0$ \\
        \midrule
        \multirow{2}{*}{Decay heat power density $\omega_j$} &
        Inlet (Core) & $\omega_j = c$ \\
        & Outlet (Core) & $u \cdot \omega_j = 0$ \\
        \midrule
        \multirow{2}{*}{Temperature $T$} &
        Inlet (Core) & $T = c$ \\
        & Outlet (Core) & $u \cdot T = 0$ \\
		\bottomrule
	\end{tabular}
	\label{table:loopbc}
\end{table}

\subsection{Flow Transfers}

This subsection details the delayed neutron and decay heat precursors, and
temperature flow transfers between the central core and outer loop regions. 

%Starting with the central core region, for the neutron group fluxes, we
%imposed vacuum boundary conditions on the
%outermost boundaries of the geometry in Figure \ref{fig:core} excluding the
%axial boundary. The \gls{DNP} variables have homogeneous Neumann boundary
%conditions along the axis and the walls in the central core region, and inflow
%and outflow boundary conditions on the inlet and outlet boundaries,
%respectively. The temperature variable shares the same type of boundary
%conditions as the \gls{DNP} variables.

A parabolic flow profile was imposed on the inlet Dirichlet boundary
condition. The equation for $u_x$ at the inlet is:
%
\begin{align}
    u_x &= -2034.01 \Big[\frac{y}{18.75} - \Big(\frac{y}{18.75}\Big)^2 
    \Big] \\
    \intertext{where}
    y = \text{height along the inlet [cm].}
\end{align}
%
The inlet is 18.75 cm high, and the coefficient at the front is from
normalizing the equation for a total volumetric flow rate of
4.5 m$^3$ s$^{-1}$.

At every timestep, Moltres also calculates weighted averages of the
temperature and the precursors at the outlet. These values are weighted by the
outflow velocity values at the outlet according to the following equation:
%
\begin{align}
    \overline{\psi} &= \frac{\int_\mathcal{C} \psi(y) u(y) dy}{
    \int_\mathcal{C} u(y) dy} \\
    \intertext{where}
    \psi &= \text{variable to be weighted} \nonumber \\
    \mathcal{C} &= \text{outlet boundary curve} \nonumber \\
    u &= \text{outflow velocity perpendicular to the outlet boundary [m
    s$^{-1}$].} \nonumber
\end{align}

This outflow value from the central core region is transferred to the 1-D
outer loop region as input for the inhomogeneous Dirichlet boundary
condition at the inlet boundary. Likewise, the outflow value from the outer
loop region is used for the inflow value in the central core region. No
averaging is required for this step as the outer loop region is a 1-D system.
We assume that the inflow temperature and \gls{DNP} are uniform at the inlet.
The Picard iterations within every timestep ensure that the two systems are
implicitly coupled even though they're solved separately.
